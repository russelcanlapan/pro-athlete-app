<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign-up - Complete</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .progress-step {
            transition: all 0.3s ease;
        }
        .progress-step.completed {
            background-color: #2563eb;
        }
        .success-animation {
            animation: bounce 0.6s ease-in-out;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50">
    <div class="min-h-screen flex items-center justify-center">
        <div class="w-full max-w-md mx-auto px-6 py-8">
            <!-- Header -->
            <header class="mb-8">
                <nav class="flex items-center justify-between mb-4" role="navigation" aria-label="Sign up progress">
                    <div class="w-6 h-6"></div>
                    
                    <div class="flex items-center gap-1.5 flex-1 mx-4" role="progressbar" aria-valuenow="6" aria-valuemin="1" aria-valuemax="6" aria-label="Step 6 of 6">
                        <div class="progress-step flex-1 h-1 bg-gray-200 rounded overflow-hidden completed"></div>
                        <div class="progress-step flex-1 h-1 bg-gray-200 rounded overflow-hidden completed"></div>
                        <div class="progress-step flex-1 h-1 bg-gray-200 rounded overflow-hidden completed"></div>
                        <div class="progress-step flex-1 h-1 bg-gray-200 rounded overflow-hidden completed"></div>
                        <div class="progress-step flex-1 h-1 bg-gray-200 rounded overflow-hidden completed"></div>
                        <div class="progress-step flex-1 h-1 bg-gray-200 rounded overflow-hidden completed"></div>
                    </div>
                    
                    <div class="w-6 h-6"></div>
                </nav>

                <h1 class="text-center text-sm font-medium text-gray-600">Welcome to ProAthlete!</h1>
            </header>

            <!-- Main Content -->
            <main class="mb-8">
                <div class="text-center mb-8">
                    <div class="success-animation mb-6">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto">
                            <span class="text-4xl">âœ…</span>
                        </div>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Account Created Successfully!</h2>
                    <p class="text-gray-600 mb-6">Your account has been created and you're ready to start your fitness journey.</p>
                    
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h3 class="font-medium text-gray-900 mb-2">Account Details:</h3>
                        <div class="text-sm text-gray-600 space-y-1">
                            <div id="accountEmail"></div>
                            <div id="accountName"></div>
                            <div id="accountType"></div>
                        </div>
                    </div>
                </div>
            </main>

                         <!-- Footer -->
             <footer class="mt-8">
                 <button id="dashboardButton" onclick="goToDashboard()" 
                         class="w-full bg-blue-600 text-white font-medium py-3 px-6 rounded-full hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                         aria-label="Go to dashboard" disabled>
                     Creating Account...
                 </button>
             </footer>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAvuUr_1NolrQ5ezg7vsMNczR4Gvg_dnpY",
            authDomain: "proathlete-288ff.firebaseapp.com",
            projectId: "proathlete-288ff",
            storageBucket: "proathlete-288ff.firebasestorage.app",
            messagingSenderId: "705749204207",
            appId: "1:705749204207:web:3a31d23cdbc917e3e7af1a",
            measurementId: "G-5TPPEX0PJD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.auth = auth;
        window.db = db;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.setDoc = setDoc;
        window.doc = doc;
    </script>

    <script>
        // Display account details
        const email = localStorage.getItem('signupEmail');
        const firstName = localStorage.getItem('signupFirstName');
        const lastName = localStorage.getItem('signupLastName');
        const password = localStorage.getItem('signupPassword');
        
        document.getElementById('accountEmail').textContent = `Email: ${email}`;
        document.getElementById('accountName').textContent = `Name: ${firstName} ${lastName}`;
        document.getElementById('accountType').textContent = `Account Type: Athlete`;

        // Create user account when page loads
        async function createUserAccount() {
            try {
                // Create user with Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Create user profile in Firestore
                const userProfile = {
                    uid: user.uid,
                    email: email,
                    firstName: firstName,
                    lastName: lastName,
                    userType: 'athlete',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    // Default athlete profile data
                    profile: {
                        age: null,
                        height: null,
                        weight: null,
                        sport: null,
                        experience: null,
                        goals: []
                    },
                    // Initialize empty data structures
                    injuries: [],
                    programs: [],
                    workouts: [],
                    progress: []
                };
                
                await setDoc(doc(db, 'athleteProfiles', user.uid), userProfile);
                
                // Store user data in session storage
                const sessionData = {
                    uid: user.uid,
                    email: user.email,
                    profile: {
                        firstName: firstName,
                        lastName: lastName,
                        email: user.email,
                        userType: 'athlete',
                        ...userProfile
                    }
                };
                sessionStorage.setItem('athleteUserData', JSON.stringify(sessionData));
                
                // Clear signup data from localStorage
                localStorage.removeItem('signupEmail');
                localStorage.removeItem('signupFirstName');
                localStorage.removeItem('signupLastName');
                localStorage.removeItem('signupPassword');
                
                                 console.log('User account created successfully!');
                 
                 // Enable the dashboard button after successful account creation
                 const dashboardButton = document.getElementById('dashboardButton');
                 dashboardButton.disabled = false;
                 dashboardButton.textContent = 'Start Onboarding';
                 dashboardButton.onclick = () => window.location.href = '/athletes/onboarding.html';
                 
             } catch (error) {
                console.error('Error creating user account:', error);
                
                // Show error message
                const errorMessage = document.createElement('div');
                errorMessage.className = 'bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage.textContent = 'An account with this email already exists. Please try logging in instead.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage.textContent = 'Password is too weak. Please use a stronger password.';
                } else {
                    errorMessage.textContent = 'Failed to create account. Please try again.';
                }
                
                // Insert error message before the main content
                const main = document.querySelector('main');
                main.parentNode.insertBefore(errorMessage, main);
                
                // Update button to go back to signup
                const button = document.querySelector('button');
                button.textContent = 'Go Back to Sign Up';
                button.onclick = () => window.location.href = 'email.html';
            }
        }

        function goToDashboard() {
            window.location.href = '/athletes/home.html';
        }

        // Create account when page loads
        createUserAccount();

        // Don't auto-redirect - let user click the button
        // setTimeout(() => {
        //     goToDashboard();
        // }, 5000);
    </script>
</body>
</html>
