<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add an Injury</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .injury-marker {
            cursor: pointer;
        }
        
        .injury-marker:hover {
            opacity: 0.8;
        }
        
        .highlighted {
            background-color: #f3f4f6 !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="sticky top-0 bg-white/90 backdrop-blur-md border-b border-gray-200 z-40">
        <div class="flex items-center justify-between p-4">
            <button onclick="goBack()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <div class="flex items-center space-x-2">
                <h1 class="text-xl font-bold text-gray-900">Add an Injury</h1>
                <button class="p-1 hover:bg-gray-100 rounded-full transition-colors">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </button>
            </div>
            <div class="w-6"></div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="px-6 py-8 max-w-4xl mx-auto pb-32">
        <!-- Professional Recommendation Banner -->
        <div class="bg-blue-600 text-white p-4 rounded-lg mb-6">
            <p class="text-sm font-medium">Recommend to be filled by a health professional.</p>
        </div>

        <!-- Form Fields -->
        <div class="space-y-6 mb-8">
            <!-- Injury Description -->
            <div>
                <label for="injuryDescription" class="block text-sm font-medium text-gray-700 mb-2">
                    Briefly describe the injury
                </label>
                <textarea id="injuryDescription" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Describe what happened and how the injury occurred"></textarea>
                <button type="button" class="mt-2 text-blue-600 text-sm font-medium hover:text-blue-700">
                    Try to be as precise as possible.
                </button>
            </div>

            <!-- Injury Start Day -->
            <div>
                <label for="injuryStartDay" class="block text-sm font-medium text-gray-700 mb-2">
                    Injury Start Day
                </label>
                <input type="date" id="injuryStartDay" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <!-- Expected Recovery Period -->
            <div>
                <label for="recoveryPeriod" class="block text-sm font-medium text-gray-700 mb-2">
                    Expected Recovery Period
                </label>
                <div class="flex space-x-2">
                    <input type="number" id="recoveryValue" min="1" class="w-1/3 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="1">
                    <select id="recoveryUnit" class="w-2/3 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="week">Week</option>
                        <option value="month" selected>Month</option>
                        <option value="year">Year</option>
                    </select>
                </div>
            </div>

            <!-- Injured Area -->
            <div>
                <label for="injuredArea" class="block text-sm font-medium text-gray-700 mb-2">
                    Injured Area
                </label>
                <div class="relative">
                    <input type="text" id="injuredArea" class="w-full px-4 py-3 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Search for injured area" autocomplete="off">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <!-- Dropdown -->
                    <div id="areaDropdown" class="hidden absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Body Diagram -->
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Mark Injury Location</h3>
                <div class="flex space-x-4">
                    <!-- Front View -->
                    <div class="flex-1" id="frontView">
                        <div class="text-center mb-2">
                            <span class="text-sm font-medium text-gray-900">Front View</span>
                        </div>
                                                 <div class="bg-gray-100 rounded-lg p-4 relative">
                             <svg class="w-full h-auto max-w-md mx-auto" viewBox="0 0 120 250" fill="none" xmlns="http://www.w3.org/2000/svg">
                                 <!-- Front View - Anatomical Body -->
                                 <!-- Head -->
                                 <path d="M 48 5 Q 60 0 72 5 Q 75 15 75 25 Q 75 35 72 40 Q 60 45 48 40 Q 45 35 45 25 Q 45 15 48 5 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Neck -->
                                 <path d="M 52 40 L 68 40 L 66 50 L 54 50 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Torso -->
                                 <path d="M 45 50 L 75 50 Q 80 60 78 70 L 78 110 Q 80 120 75 125 L 45 125 Q 40 120 42 110 L 42 70 Q 40 60 45 50 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Arms -->
                                 <!-- Right Arm -->
                                 <path d="M 75 50 Q 85 55 88 70 Q 90 85 88 100 L 82 95 Q 80 85 78 75 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 <!-- Left Arm -->
                                 <path d="M 45 50 Q 35 55 32 70 Q 30 85 32 100 L 38 95 Q 40 85 42 75 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Hands -->
                                 <ellipse cx="85" cy="105" rx="5" ry="8" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 <ellipse cx="35" cy="105" rx="5" ry="8" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Legs -->
                                 <!-- Right Leg -->
                                 <path d="M 65 125 Q 70 130 72 150 Q 74 170 72 190 L 68 185 Q 66 170 64 155 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 <!-- Left Leg -->
                                 <path d="M 55 125 Q 50 130 48 150 Q 46 170 48 190 L 52 185 Q 54 170 56 155 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Feet -->
                                 <ellipse cx="70" cy="195" rx="8" ry="4" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 <ellipse cx="50" cy="195" rx="8" ry="4" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Injury Marker (Red circle) - Right Knee -->
                                 <circle cx="70" cy="190" r="4" fill="#ef4444" class="injury-marker" onclick="markInjury('right-knee')"/>
                             </svg>
                         </div>
                    </div>
                    
                    <!-- Back View -->
                    <div class="flex-1" id="backView">
                        <div class="text-center mb-2">
                            <span class="text-sm font-medium text-gray-900">Back View</span>
                        </div>
                                                 <div class="bg-gray-100 rounded-lg p-4 relative">
                             <svg class="w-full h-auto max-w-md mx-auto" viewBox="0 0 120 250" fill="none" xmlns="http://www.w3.org/2000/svg">
                                 <!-- Back View - Anatomical Body -->
                                 <!-- Head -->
                                 <path d="M 48 5 Q 60 0 72 5 Q 75 15 75 25 Q 75 35 72 40 Q 60 45 48 40 Q 45 35 45 25 Q 45 15 48 5 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Neck -->
                                 <path d="M 52 40 L 68 40 L 66 50 L 54 50 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Torso -->
                                 <path d="M 45 50 L 75 50 Q 80 60 78 70 L 78 110 Q 80 120 75 125 L 45 125 Q 40 120 42 110 L 42 70 Q 40 60 45 50 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Arms -->
                                 <!-- Right Arm -->
                                 <path d="M 75 50 Q 85 55 88 70 Q 90 85 88 100 L 82 95 Q 80 85 78 75 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 <!-- Left Arm -->
                                 <path d="M 45 50 Q 35 55 32 70 Q 30 85 32 100 L 38 95 Q 40 85 42 75 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Hands -->
                                 <ellipse cx="85" cy="105" rx="5" ry="8" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 <ellipse cx="35" cy="105" rx="5" ry="8" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Legs -->
                                 <!-- Right Leg -->
                                 <path d="M 65 125 Q 70 130 72 150 Q 74 170 72 190 L 68 185 Q 66 170 64 155 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 <!-- Left Leg -->
                                 <path d="M 55 125 Q 50 130 48 150 Q 46 170 48 190 L 52 185 Q 54 170 56 155 Z" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 
                                 <!-- Feet -->
                                 <ellipse cx="70" cy="195" rx="8" ry="4" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                                 <ellipse cx="50" cy="195" rx="8" ry="4" stroke="#1e40af" stroke-width="2" fill="#dbeafe"/>
                             </svg>
                         </div>
                    </div>
                </div>
            </div>

            <!-- Allowed Activities -->
            <div>
                <label for="allowedActivities" class="block text-sm font-medium text-gray-700 mb-2">
                    Allowed Activities
                </label>
                <textarea id="allowedActivities" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="List activities that are allowed"></textarea>
            </div>

            <!-- Restrictions -->
            <div>
                <label for="restrictions" class="block text-sm font-medium text-gray-700 mb-2">
                    Restrictions
                </label>
                <textarea id="restrictions" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="List activities that are restricted"></textarea>
            </div>

            <!-- Other Instructions -->
            <div>
                <div class="flex items-center space-x-2 mb-2">
                    <label for="otherInstructions" class="block text-sm font-medium text-gray-700">
                        Other Instructions
                    </label>
                    <button class="p-1 hover:bg-gray-100 rounded-full transition-colors">
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </button>
                </div>
                <textarea id="otherInstructions" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Add any other relevant instructions"></textarea>
            </div>

            <!-- Recommended Rehab Exercises -->
            <div>
                <label for="rehabExercises" class="block text-sm font-medium text-gray-700 mb-2">
                    Recommended Rehab Exercises
                </label>
                <textarea id="rehabExercises" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="List recommended rehabilitation exercises"></textarea>
            </div>

            <!-- Visibility to Coach -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Visible to coach?
                </label>
                <div class="flex space-x-4">
                    <label class="flex items-center">
                        <input type="radio" name="visibility" value="yes" checked class="mr-2">
                        <span class="text-sm text-gray-700">Yes</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="visibility" value="no" class="mr-2">
                        <span class="text-sm text-gray-700">No</span>
                    </label>
                </div>
                <p class="text-xs text-gray-500 mt-1">(You can change the visibility later).</p>
            </div>
        </div>



        <!-- Action Buttons -->
        <div class="flex space-x-4">
            <button onclick="saveDraft()" class="flex-1 py-3 px-4 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors">
                Cancel
            </button>
            <button onclick="saveInjury()" class="flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                Submit
            </button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg">
        <div class="flex justify-around py-3">
            <a href="home.html" class="flex flex-col items-center text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m0 0l-7 7m7-7v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                <span class="text-xs mt-1">Home</span>
            </a>
            <a href="tracking.html" class="flex flex-col items-center text-blue-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <span class="text-xs mt-1">Tracking</span>
            </a>
            <a href="profile.html" class="flex flex-col items-center text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <span class="text-xs mt-1">Profile</span>
            </a>
        </div>
    </div>

    <!-- Notice Modal -->
    <div id="noticeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 mx-4 max-w-sm w-full">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Notice</h3>
            <p class="text-gray-700 mb-6">We recommend that this form is filled out by a health professional</p>
            <button onclick="closeNoticeModal()" class="w-full py-2 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
                Ok
            </button>
        </div>
    </div>

    <!-- Save Draft Modal -->
    <div id="saveDraftModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 mx-4 max-w-sm w-full">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Save the Draft?</h3>
            <p class="text-gray-700 mb-6">Save the progress when returning to this page.</p>
            <div class="flex space-x-3">
                <button onclick="discardDraft()" class="flex-1 py-2 px-4 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                    Discard
                </button>
                <button onclick="confirmSaveDraft()" class="flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
                    Save
                </button>
            </div>
        </div>
    </div>

    <script>
        // All possible injured areas
        const injuredAreas = [
            'Abdominal area (Left)',
            'Abdominal area (Right)',
            'Ankle (Left)',
            'Ankle (Right)',
            'Arm (Left)',
            'Arm (Right)',
            'Calf (Left)',
            'Calf (Right)',
            'Chest area',
            'Elbow (Left)',
            'Elbow (Right)',
            'Face',
            'Finger (Left)',
            'Finger (Right)',
            'Foot (Left)',
            'Foot (Right)',
            'Forearm (Left)',
            'Forearm (Right)',
            'Glute (Left)',
            'Glute (Right)',
            'Hamstring (Left)',
            'Hamstring (Right)',
            'Hand (Left)',
            'Hand (Right)',
            'Head',
            'Hip (Left)',
            'Hip (Right)',
            'Knee (Left)',
            'Knee (Right)',
            'Lower back',
            'Mid back',
            'Neck',
            'Pelvis/SI joint (Left)',
            'Pelvis/SI joint (Right)',
            'Quadriceps (Left)',
            'Quadriceps (Right)',
            'Ribs (Left)',
            'Ribs (Right)',
            'Shoulder (Left)',
            'Shoulder (Right)',
            'Shin (Left)',
            'Shin (Right)',
            'Thumb (Left)',
            'Thumb (Right)',
            'Toe (Left)',
            'Toe (Right)',
            'Upper back',
            'Wrist (Left)',
            'Wrist (Right)'
        ];

        let selectedInjuredArea = '';

        // Initialize page on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSearchDropdown();
            // Show notice modal on page load
            document.getElementById('noticeModal').classList.remove('hidden');
        });

        function initializeSearchDropdown() {
            const input = document.getElementById('injuredArea');
            const dropdown = document.getElementById('areaDropdown');

            // Show dropdown when input is focused
            input.addEventListener('focus', function() {
                showDropdown();
            });

            // Handle input changes for filtering
            input.addEventListener('input', function() {
                filterOptions(this.value);
            });

            // Handle keyboard navigation
            input.addEventListener('keydown', function(e) {
                const options = dropdown.querySelectorAll('.dropdown-option');
                const highlighted = dropdown.querySelector('.highlighted');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (!highlighted) {
                        options[0]?.classList.add('highlighted');
                    } else {
                        highlighted.classList.remove('highlighted');
                        const next = highlighted.nextElementSibling;
                        if (next) {
                            next.classList.add('highlighted');
                        } else {
                            options[0]?.classList.add('highlighted');
                        }
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (highlighted) {
                        highlighted.classList.remove('highlighted');
                        const prev = highlighted.previousElementSibling;
                        if (prev) {
                            prev.classList.add('highlighted');
                        } else {
                            options[options.length - 1]?.classList.add('highlighted');
                        }
                    }
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (highlighted) {
                        selectOption(highlighted.textContent);
                    }
                } else if (e.key === 'Escape') {
                    hideDropdown();
                }
            });

            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                    hideDropdown();
                }
            });
        }

        function showDropdown() {
            const dropdown = document.getElementById('areaDropdown');
            dropdown.classList.remove('hidden');
            populateDropdown(injuredAreas);
        }

        function hideDropdown() {
            const dropdown = document.getElementById('areaDropdown');
            dropdown.classList.add('hidden');
        }

        function populateDropdown(options) {
            const dropdown = document.getElementById('areaDropdown');
            dropdown.innerHTML = '';
            
            options.forEach(option => {
                const div = document.createElement('div');
                div.className = 'dropdown-option px-4 py-3 hover:bg-gray-100 cursor-pointer text-sm';
                div.textContent = option;
                div.addEventListener('click', function() {
                    selectOption(option);
                });
                div.addEventListener('mouseenter', function() {
                    // Remove highlight from other options
                    dropdown.querySelectorAll('.dropdown-option').forEach(opt => {
                        opt.classList.remove('highlighted');
                    });
                    // Add highlight to this option
                    this.classList.add('highlighted');
                });
                dropdown.appendChild(div);
            });
        }

        function filterOptions(searchTerm) {
            const filtered = injuredAreas.filter(area => 
                area.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filtered.length > 0) {
                populateDropdown(filtered);
                showDropdown();
            } else {
                hideDropdown();
            }
        }

        function selectOption(option) {
            document.getElementById('injuredArea').value = option;
            selectedInjuredArea = option;
            hideDropdown();
            placeInjuryMarker(option);
        }

        function placeInjuryMarker(injuredArea) {
            // Remove any existing injury markers
            removeExistingMarkers();
            
            // Get the coordinates for the selected area
            const coordinates = getInjuryCoordinates(injuredArea);
            
            if (coordinates) {
                // Add marker to the appropriate view
                if (coordinates.view === 'front') {
                    addMarkerToFrontView(coordinates.x, coordinates.y);
                } else if (coordinates.view === 'back') {
                    addMarkerToBackView(coordinates.x, coordinates.y);
                }
            }
        }

        function removeExistingMarkers() {
            // Remove existing markers from both views
            const frontMarkers = document.querySelectorAll('#frontView svg .injury-marker');
            const backMarkers = document.querySelectorAll('#backView svg .injury-marker');
            
            frontMarkers.forEach(marker => marker.remove());
            backMarkers.forEach(marker => marker.remove());
        }

        function addMarkerToFrontView(x, y) {
            const frontSvg = document.querySelector('#frontView svg');
            if (frontSvg) {
                const marker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                marker.setAttribute('cx', x);
                marker.setAttribute('cy', y);
                marker.setAttribute('r', '6');
                marker.setAttribute('fill', '#ef4444');
                marker.classList.add('injury-marker');
                frontSvg.appendChild(marker);
            }
        }

        function addMarkerToBackView(x, y) {
            const backSvg = document.querySelector('#backView svg');
            if (backSvg) {
                const marker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                marker.setAttribute('cx', x);
                marker.setAttribute('cy', y);
                marker.setAttribute('r', '6');
                marker.setAttribute('fill', '#ef4444');
                marker.classList.add('injury-marker');
                backSvg.appendChild(marker);
            }
        }

                 function getInjuryCoordinates(injuredArea) {
             // Define coordinates for different body areas
             // Note: In the front view, left side of diagram = person's right side
             const coordinates = {
                 // Front view coordinates (corrected for anatomical positioning)
                 'Head': { view: 'front', x: 60, y: 20 },
                 'Neck': { view: 'front', x: 60, y: 45 },
                 'Shoulder (Right)': { view: 'front', x: 75, y: 55 }, // Left side of diagram
                 'Shoulder (Left)': { view: 'front', x: 45, y: 55 },  // Right side of diagram
                 'Chest area': { view: 'front', x: 60, y: 80 },
                 'Arm (Right)': { view: 'front', x: 85, y: 85 },     // Left side of diagram
                 'Arm (Left)': { view: 'front', x: 35, y: 85 },      // Right side of diagram
                 'Elbow (Right)': { view: 'front', x: 88, y: 105 },  // Left side of diagram
                 'Elbow (Left)': { view: 'front', x: 32, y: 105 },   // Right side of diagram
                 'Forearm (Right)': { view: 'front', x: 85, y: 115 }, // Left side of diagram
                 'Forearm (Left)': { view: 'front', x: 35, y: 115 },  // Right side of diagram
                 'Hand (Right)': { view: 'front', x: 85, y: 125 },    // Left side of diagram
                 'Hand (Left)': { view: 'front', x: 35, y: 125 },     // Right side of diagram
                 'Wrist (Right)': { view: 'front', x: 85, y: 130 },   // Left side of diagram
                 'Wrist (Left)': { view: 'front', x: 35, y: 130 },    // Right side of diagram
                 'Finger (Right)': { view: 'front', x: 85, y: 135 },  // Left side of diagram
                 'Finger (Left)': { view: 'front', x: 35, y: 135 },   // Right side of diagram
                 'Thumb (Right)': { view: 'front', x: 90, y: 125 },   // Left side of diagram
                 'Thumb (Left)': { view: 'front', x: 30, y: 125 },    // Right side of diagram
                 'Abdominal area (Right)': { view: 'front', x: 65, y: 100 }, // Left side of diagram
                 'Abdominal area (Left)': { view: 'front', x: 55, y: 100 },  // Right side of diagram
                 'Hip (Right)': { view: 'front', x: 70, y: 120 },     // Left side of diagram
                 'Hip (Left)': { view: 'front', x: 50, y: 120 },      // Right side of diagram
                 'Quadriceps (Right)': { view: 'front', x: 75, y: 150 }, // Left side of diagram
                 'Quadriceps (Left)': { view: 'front', x: 45, y: 150 },  // Right side of diagram
                 'Knee (Right)': { view: 'front', x: 78, y: 185 },    // Left side of diagram
                 'Knee (Left)': { view: 'front', x: 42, y: 185 },     // Right side of diagram
                 'Shin (Right)': { view: 'front', x: 75, y: 205 },    // Left side of diagram
                 'Shin (Left)': { view: 'front', x: 45, y: 205 },     // Right side of diagram
                 'Calf (Right)': { view: 'front', x: 75, y: 220 },    // Left side of diagram
                 'Calf (Left)': { view: 'front', x: 45, y: 220 },     // Right side of diagram
                 'Ankle (Right)': { view: 'front', x: 75, y: 230 },   // Left side of diagram
                 'Ankle (Left)': { view: 'front', x: 45, y: 230 },    // Right side of diagram
                 'Foot (Right)': { view: 'front', x: 75, y: 235 },    // Left side of diagram
                 'Foot (Left)': { view: 'front', x: 45, y: 235 },     // Right side of diagram
                 'Toe (Right)': { view: 'front', x: 75, y: 240 },     // Left side of diagram
                 'Toe (Left)': { view: 'front', x: 45, y: 240 },      // Right side of diagram
                 'Face': { view: 'front', x: 60, y: 25 },
                 
                 // Back view coordinates (corrected for anatomical positioning)
                 'Upper back': { view: 'back', x: 60, y: 80 },
                 'Mid back': { view: 'back', x: 60, y: 95 },
                 'Lower back': { view: 'back', x: 60, y: 110 },
                 'Glute (Right)': { view: 'back', x: 65, y: 130 },   // Left side of diagram
                 'Glute (Left)': { view: 'back', x: 55, y: 130 },    // Right side of diagram
                 'Hamstring (Right)': { view: 'back', x: 75, y: 170 }, // Left side of diagram
                 'Hamstring (Left)': { view: 'back', x: 45, y: 170 },  // Right side of diagram
                 'Pelvis/SI joint (Right)': { view: 'back', x: 65, y: 120 }, // Left side of diagram
                 'Pelvis/SI joint (Left)': { view: 'back', x: 55, y: 120 },  // Right side of diagram
                 'Ribs (Right)': { view: 'back', x: 70, y: 90 },     // Left side of diagram
                 'Ribs (Left)': { view: 'back', x: 50, y: 90 }       // Right side of diagram
             };
            
            return coordinates[injuredArea] || null;
        }

        function closeNoticeModal() {
            document.getElementById('noticeModal').classList.add('hidden');
        }

        function saveDraft() {
            document.getElementById('saveDraftModal').classList.remove('hidden');
        }

        function discardDraft() {
            document.getElementById('saveDraftModal').classList.add('hidden');
            window.history.back();
        }

        function confirmSaveDraft() {
            // Save current form data to session storage
            const draftData = {
                description: document.getElementById('injuryDescription').value,
                startDay: document.getElementById('injuryStartDay').value,
                recoveryValue: document.getElementById('recoveryValue').value,
                recoveryUnit: document.getElementById('recoveryUnit').value,
                injuredArea: selectedInjuredArea,
                allowedActivities: document.getElementById('allowedActivities').value,
                restrictions: document.getElementById('restrictions').value,
                otherInstructions: document.getElementById('otherInstructions').value,
                rehabExercises: document.getElementById('rehabExercises').value,
                visibility: document.querySelector('input[name="visibility"]:checked').value,
                dateCreated: new Date().toISOString()
            };
            
            sessionStorage.setItem('injuryDraft', JSON.stringify(draftData));
            document.getElementById('saveDraftModal').classList.add('hidden');
            window.history.back();
        }

        function saveInjury() {
            const description = document.getElementById('injuryDescription').value;
            const startDay = document.getElementById('injuryStartDay').value;
            const recoveryValue = document.getElementById('recoveryValue').value;
            const recoveryUnit = document.getElementById('recoveryUnit').value;
            
            if (!description || !startDay || !recoveryValue || !selectedInjuredArea) {
                alert('Please fill in all required fields and select an injured area.');
                return;
            }
            
            // Create injury data
            const injuryData = {
                description: description,
                startDay: startDay,
                recoveryPeriod: `${recoveryValue} ${recoveryUnit}${recoveryValue > 1 ? 's' : ''}`,
                injuredArea: selectedInjuredArea,
                allowedActivities: document.getElementById('allowedActivities').value,
                restrictions: document.getElementById('restrictions').value,
                otherInstructions: document.getElementById('otherInstructions').value,
                rehabExercises: document.getElementById('rehabExercises').value,
                visibility: document.querySelector('input[name="visibility"]:checked').value,
                dateCreated: new Date().toISOString()
            };
            
            // Save to session storage (in a real app, this would go to a database)
            const existingInjuries = JSON.parse(sessionStorage.getItem('userInjuries') || '[]');
            existingInjuries.push(injuryData);
            sessionStorage.setItem('userInjuries', JSON.stringify(existingInjuries));
            
            // Clear any existing draft
            sessionStorage.removeItem('injuryDraft');
            
            // Navigate back to injury statistics
            window.location.href = 'injury-statistics.html';
        }

        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html>
