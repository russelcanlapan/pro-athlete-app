<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teams</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .team-card {
            transition: all 0.2s ease;
        }
        
        .team-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="min-h-screen">


        <!-- Main Content -->
        <div class="px-6 py-8 max-w-4xl mx-auto">
            <!-- Header -->
            <h1 class="text-3xl font-bold text-gray-900 mb-8">Teams</h1>

            <!-- Team Cards -->
            <div id="teamsContainer" class="space-y-4 mb-8">
                <!-- Teams will be dynamically loaded here -->
            </div>

            <!-- Add Team Section -->
            <div class="team-card border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all duration-200" onclick="addNewTeam()">
                <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-gray-700">Add Team</h3>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200">
            <div class="flex justify-around py-3">
                <a href="home.html" class="flex flex-col items-center py-2 px-4 text-gray-500 hover:text-gray-700 transition-colors">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    <span class="text-xs font-medium">Home</span>
                </a>
                <a href="teams.html" class="flex flex-col items-center py-2 px-4 text-blue-600">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    <span class="text-xs font-medium">Tracking</span>
                </a>
                <a href="profile.html" class="flex flex-col items-center py-2 px-4 text-gray-500 hover:text-gray-700 transition-colors">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span class="text-xs font-medium">Profile</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        let coachTeams = [];

        // Load coach teams on page load
        window.addEventListener('load', function() {
            // Fix Phil Jackson's team assignment if needed
            fixPhilJacksonTeamAssignment();
            loadCoachTeams();
        });

        function fixPhilJacksonTeamAssignment() {
            // Ensure Phil Jackson has the correct team assignment
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const philIndex = registeredUsers.findIndex(u => u.email === 'earl.foronda@outlook.com');
            
            if (philIndex !== -1) {
                if (!registeredUsers[philIndex].teamName || registeredUsers[philIndex].teamName.trim() === '') {
                    registeredUsers[philIndex].teamName = 'Brookwood Elite';
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                    console.log('Fixed Phil Jackson team assignment to Brookwood Elite');
                }
            }
            
            // Also fix in users array if present
            const allUsers = JSON.parse(localStorage.getItem('users') || '[]');
            const philInUsers = allUsers.findIndex(u => u.email === 'earl.foronda@outlook.com');
            
            if (philInUsers !== -1) {
                if (!allUsers[philInUsers].teamName || allUsers[philInUsers].teamName.trim() === '') {
                    allUsers[philInUsers].teamName = 'Brookwood Elite';
                    localStorage.setItem('users', JSON.stringify(allUsers));
                    console.log('Fixed Phil Jackson team assignment in users array');
                }
            }
        }

        function loadCoachTeams() {
            // Get coach data from session storage
            const coachUserData = JSON.parse(sessionStorage.getItem('coachUserData') || '{}');
            const coachProfile = JSON.parse(localStorage.getItem('coachProfile') || '{}');
            
            // Get coach's team name
            let teamName = 'Unknown Team';
            let coachFirstName = 'Coach';
            
            if (coachUserData.firstName) {
                coachFirstName = coachUserData.firstName;
            }
            
            // Check registeredUsers first for most up-to-date team assignment
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const coachInRegistry = registeredUsers.find(u => u.id === coachUserData.id || u.email === coachUserData.email);
            
            if (coachInRegistry && coachInRegistry.teamName && coachInRegistry.teamName.trim()) {
                teamName = coachInRegistry.teamName;
            } else if (coachUserData.teamName && coachUserData.teamName.trim()) {
                teamName = coachUserData.teamName;
            } else if (coachUserData.profile?.teamName && coachUserData.profile.teamName.trim()) {
                teamName = coachUserData.profile.teamName;
            } else if (coachProfile.teamName && coachProfile.teamName.trim()) {
                teamName = coachProfile.teamName;
            } else {
                // Default fallback - but for Phil Jackson, should be "Brookwood Elite"
                if (coachUserData.firstName === 'Phil' && coachUserData.lastName === 'Jackson') {
                    teamName = 'Brookwood Elite';
                } else {
                    teamName = `${coachFirstName}'s Team`;
                }
            }
            
            console.log(`Coach ${coachFirstName} manages team: "${teamName}"`);
            
            // Count athletes for this team - check both users and registeredUsers arrays
            const allUsers = JSON.parse(localStorage.getItem('users') || '[]');
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            
            // Combine both arrays and filter for athletes on this team
            const combinedUsers = [...allUsers, ...registeredUsers];
            
            // Remove duplicates based on email or id
            const uniqueUsers = combinedUsers.filter((user, index, self) => 
                index === self.findIndex((u) => (u.email === user.email) || (u.id === user.id))
            );
            
            const teamAthletes = uniqueUsers.filter(user => {
                const isAthlete = user.accountType === 'athlete' || user.profile?.userType === 'athlete';
                const onTeam = user.teamName === teamName || user.profile?.teamName === teamName;
                
                console.log(`User ${user.firstName || user.profile?.firstName}: athlete=${isAthlete}, team="${user.teamName || user.profile?.teamName}", matches="${teamName}"=${onTeam}`);
                
                return isAthlete && onTeam;
            });
            
            console.log(`Found ${teamAthletes.length} athletes on team "${teamName}":`, teamAthletes);
            
            // Create team object
            const team = {
                name: teamName,
                athleteCount: teamAthletes.length,
                sport: 'Basketball', // Default sport
                icon: 'üèÄ'
            };
            
            coachTeams = [team];
            renderTeams();
        }

        function renderTeams() {
            const container = document.getElementById('teamsContainer');
            
            if (coachTeams.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <p class="text-gray-500">No teams found</p>
                    </div>
                `;
                return;
            }
            
            const teamsHTML = coachTeams.map(team => `
                <div class="team-card bg-blue-600 rounded-2xl p-6 cursor-pointer" onclick="selectTeam('${team.name}')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                            <span class="text-2xl">${team.icon}</span>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-xl font-bold text-white mb-1">${team.name}</h3>
                            <p class="text-white/80 text-sm mb-2">(${team.athleteCount} athletes)</p>
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-white/80 text-sm">${team.sport}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = teamsHTML;
        }

        function selectTeam(teamName) {
            // Navigate to the tracking page with the selected team
            window.location.href = `tracking.html?team=${encodeURIComponent(teamName)}`;
        }

        function addNewTeam() {
            alert('Add Team functionality coming soon!');
        }
    </script>
</body>
</html>
